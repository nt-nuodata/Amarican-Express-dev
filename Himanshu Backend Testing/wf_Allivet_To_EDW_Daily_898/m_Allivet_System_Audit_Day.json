{"Edges":[{"id":"e-0","source":"Shortcut_to_ALLIVET_SYSTEM_AUDIT_DAY","target":"SQ_Shortcut_to_ALLIVET_SYSTEM_AUDIT_DAY","transformationType":"Source Qualifier"},{"id":"e-1","source":"Shortcut_to_ALLIVET_DAILY_SYSTEM_AUDIT_PRE","target":"SQ_Shortcut_to_ALLIVET_DAILY_SYSTEM_AUDIT_PRE","transformationType":"Source Qualifier"},{"id":"e-2","source":"SQ_Shortcut_to_ALLIVET_DAILY_SYSTEM_AUDIT_PRE","target":"Jnr_Audit_Target","transformationType":"Joiner"},{"id":"e-3","source":"SQ_Shortcut_to_ALLIVET_SYSTEM_AUDIT_DAY","target":"Jnr_Audit_Target","transformationType":"Joiner"},{"id":"e-4","source":"Jnr_Audit_Target","target":"Exp_Update_Flag","transformationType":"Expression"},{"id":"e-5","source":"Exp_Update_Flag","target":"Filter_Update_Insert","transformationType":"Filter"},{"id":"e-6","source":"Filter_Update_Insert","target":"UPDTRANS","transformationType":"Update Strategy"},{"id":"e-7","source":"UPDTRANS","target":"Shortcut_to_ALLIVET_SYSTEM_AUDIT_DAY1","transformationType":"Target Definition"}],"Nodes":[{"data":{"transformationType":"Source Definition","label":"Shortcut_to_ALLIVET_SYSTEM_AUDIT_DAY","queries":["df_0 = spark.sql(\"\"\"SELECT\n  ALLIVET_ORDER_NBR_V2_test AS ALLIVET_ORDER_NBR,\n  ALLIVET_ORDER_CNTR AS ALLIVET_ORDER_CNTR,\n  ALLIVET_ORDER_LN_NBR_V2_test AS ALLIVET_ORDER_LN_NBR,\n  OPERATION_V2_test AS OPERATION,\n  ALLIVET_CUSTOMER_NBR AS ALLIVET_CUSTOMER_NBR,\n  EXTRA_INFO AS EXTRA_INFO,\n  ORDER_CHG_DT AS ORDER_CHG_DT,\n  FROM_ITEM_CD AS FROM_ITEM_CD,\n  TO_ITEM_CD AS TO_ITEM_CD,\n  PRESCRIPTION_ID_V2_test AS PRESCRIPTION_ID,\n  UPDATE_TSTMP AS UPDATE_TSTMP,\n  LOAD_TSTMP AS LOAD_TSTMP\nFROM\n  ALLIVET_SYSTEM_AUDIT_DAY_V2_test\"\"\")","df_0.createOrReplaceTempView(\"Shortcut_to_ALLIVET_SYSTEM_AUDIT_DAY_0\")"]},"id":"Shortcut_to_ALLIVET_SYSTEM_AUDIT_DAY","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Source Qualifier","label":"SQ_Shortcut_to_ALLIVET_SYSTEM_AUDIT_DAY","queries":["df_1 = spark.sql(\"\"\"SELECT\n  ALLIVET_ORDER_NBR AS ALLIVET_ORDER_NBR,\n  ALLIVET_ORDER_CNTR AS ALLIVET_ORDER_CNTR,\n  ALLIVET_ORDER_LN_NBR AS ALLIVET_ORDER_LN_NBR,\n  OPERATION AS OPERATION,\n  ALLIVET_CUSTOMER_NBR AS ALLIVET_CUSTOMER_NBR,\n  EXTRA_INFO AS EXTRA_INFO,\n  ORDER_CHG_DT AS ORDER_CHG_DT,\n  FROM_ITEM_CD AS FROM_ITEM_CD,\n  TO_ITEM_CD AS TO_ITEM_CD,\n  PRESCRIPTION_ID AS PRESCRIPTION_ID,\n  UPDATE_TSTMP AS UPDATE_TSTMP,\n  LOAD_TSTMP AS LOAD_TSTMP,\n  monotonically_increasing_id() AS Monotonically_Increasing_Id\nFROM\n  Shortcut_to_ALLIVET_SYSTEM_AUDIT_DAY_0\"\"\")","df_1.createOrReplaceTempView(\"SQ_Shortcut_to_ALLIVET_SYSTEM_AUDIT_DAY_1\")"]},"id":"SQ_Shortcut_to_ALLIVET_SYSTEM_AUDIT_DAY","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Source Definition","label":"Shortcut_to_ALLIVET_DAILY_SYSTEM_AUDIT_PRE","queries":["df_2 = spark.sql(\"\"\"SELECT\n  ALLIVET_ORDER_CODE_V2_test AS ALLIVET_ORDER_CODE,\n  ALLIVET_ORDER_COUNTER AS ALLIVET_ORDER_COUNTER,\n  ALLIVET_ORDER_LINE_NUMBER AS ALLIVET_ORDER_LINE_NUMBER,\n  OPERATION_V2_test AS OPERATION,\n  CUSTOMER_CODE AS CUSTOMER_CODE,\n  EXTRA_INFO AS EXTRA_INFO,\n  CHANGE_DATE AS CHANGE_DATE,\n  FROM_ITEM_CODE AS FROM_ITEM_CODE,\n  TO_ITEM_CODE AS TO_ITEM_CODE,\n  PRESCRIPTION_ID_V2_test AS PRESCRIPTION_ID,\n  LOAD_TSTMP AS LOAD_TSTMP\nFROM\n  ALLIVET_DAILY_SYSTEM_AUDIT_PRE\"\"\")","df_2.createOrReplaceTempView(\"Shortcut_to_ALLIVET_DAILY_SYSTEM_AUDIT_PRE_2\")"]},"id":"Shortcut_to_ALLIVET_DAILY_SYSTEM_AUDIT_PRE","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Source Qualifier","label":"SQ_Shortcut_to_ALLIVET_DAILY_SYSTEM_AUDIT_PRE","queries":["df_3 = spark.sql(\"\"\"SELECT\n  ALLIVET_ORDER_CODE AS ALLIVET_ORDER_CODE,\n  ALLIVET_ORDER_COUNTER AS ALLIVET_ORDER_COUNTER,\n  ALLIVET_ORDER_LINE_NUMBER AS ALLIVET_ORDER_LINE_NUMBER,\n  OPERATION AS OPERATION,\n  CUSTOMER_CODE AS CUSTOMER_CODE,\n  EXTRA_INFO AS EXTRA_INFO,\n  CHANGE_DATE AS CHANGE_DATE,\n  FROM_ITEM_CODE AS FROM_ITEM_CODE,\n  TO_ITEM_CODE AS TO_ITEM_CODE,\n  PRESCRIPTION_ID AS PRESCRIPTION_ID,\n  LOAD_TSTMP AS LOAD_TSTMP,\n  monotonically_increasing_id() AS Monotonically_Increasing_Id\nFROM\n  Shortcut_to_ALLIVET_DAILY_SYSTEM_AUDIT_PRE_2\"\"\")","df_3.createOrReplaceTempView(\"SQ_Shortcut_to_ALLIVET_DAILY_SYSTEM_AUDIT_PRE_3\")"]},"id":"SQ_Shortcut_to_ALLIVET_DAILY_SYSTEM_AUDIT_PRE","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Joiner","label":"Jnr_Audit_Target","queries":["df_4 = spark.sql(\"\"\"SELECT\n  DETAIL.ALLIVET_ORDER_CODE AS ALLIVET_ORDER_CODE,\n  DETAIL.ALLIVET_ORDER_COUNTER AS ALLIVET_ORDER_COUNTER,\n  DETAIL.ALLIVET_ORDER_LINE_NUMBER AS ALLIVET_ORDER_LINE_NUMBER,\n  DETAIL.OPERATION AS OPERATION,\n  DETAIL.CUSTOMER_CODE AS CUSTOMER_CODE,\n  DETAIL.EXTRA_INFO AS EXTRA_INFO,\n  DETAIL.CHANGE_DATE AS CHANGE_DATE,\n  DETAIL.FROM_ITEM_CODE AS FROM_ITEM_CODE,\n  DETAIL.TO_ITEM_CODE AS TO_ITEM_CODE,\n  DETAIL.PRESCRIPTION_ID AS PRESCRIPTION_ID,\n  DETAIL.LOAD_TSTMP AS LOAD_TSTMP,\n  MASTER.ALLIVET_ORDER_NBR AS Lkp_ALLIVET_ORDER_NBR,\n  MASTER.ALLIVET_ORDER_CNTR AS Lkp_ALLIVET_ORDER_CNTR,\n  MASTER.ALLIVET_ORDER_LN_NBR AS Lkp_ALLIVET_ORDER_LN_NBR,\n  MASTER.OPERATION AS LKP_OPERATION,\n  MASTER.ALLIVET_CUSTOMER_NBR AS LKP_ALLIVET_CUSTOMER_NBR,\n  MASTER.EXTRA_INFO AS LKP_EXTRA_INFO,\n  MASTER.ORDER_CHG_DT AS LKP_ORDER_CHG_DT,\n  MASTER.FROM_ITEM_CD AS LKP_FROM_ITEM_CD,\n  MASTER.TO_ITEM_CD AS LKP_TO_ITEM_CD,\n  MASTER.PRESCRIPTION_ID AS LKP_PRESCRIPTION_ID,\n  DETAIL.Monotonically_Increasing_Id AS Monotonically_Increasing_Id\nFROM\n  SQ_Shortcut_to_ALLIVET_SYSTEM_AUDIT_DAY_1 MASTER\n  RIGHT JOIN SQ_Shortcut_to_ALLIVET_DAILY_SYSTEM_AUDIT_PRE_3 DETAIL ON MASTER.ALLIVET_ORDER_NBR = DETAIL.ALLIVET_ORDER_CODE\n  AND MASTER.ALLIVET_ORDER_CNTR = DETAIL.ALLIVET_ORDER_COUNTER\"\"\")","df_4.createOrReplaceTempView(\"Jnr_Audit_Target_4\")"]},"id":"Jnr_Audit_Target","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Expression","label":"Exp_Update_Flag","queries":["df_5 = spark.sql(\"\"\"SELECT\n  ALLIVET_ORDER_CODE AS ALLIVET_ORDER_CODE,\n  ALLIVET_ORDER_COUNTER AS ALLIVET_ORDER_COUNTER,\n  ALLIVET_ORDER_LINE_NUMBER AS ALLIVET_ORDER_LINE_NUMBER,\n  OPERATION AS OPERATION,\n  CUSTOMER_CODE AS CUSTOMER_CODE,\n  EXTRA_INFO AS EXTRA_INFO,\n  CHANGE_DATE AS CHANGE_DATE,\n  FROM_ITEM_CODE AS FROM_ITEM_CODE,\n  TO_ITEM_CODE AS TO_ITEM_CODE,\n  PRESCRIPTION_ID AS PRESCRIPTION_ID,\n  LOAD_TSTMP AS LOAD_TSTMP,\n  now() AS UPDATE_TSTMP,\n  IFF(\n    (\n      ISNULL(Lkp_ALLIVET_ORDER_NBR)\n      OR ISNULL(Lkp_ALLIVET_ORDER_CNTR)\n    ),\n    1,\n    IFF(\n      NOT(\n        ISNULL(Lkp_ALLIVET_ORDER_NBR)\n        OR ISNULL(Lkp_ALLIVET_ORDER_CNTR)\n      )\n      AND (\n        IFF(\n          ISNULL(ALLIVET_ORDER_LINE_NUMBER),\n          -1,\n          ALLIVET_ORDER_LINE_NUMBER\n        ) <> IFF(\n          ISNULL(Lkp_ALLIVET_ORDER_LN_NBR),\n          -1,\n          Lkp_ALLIVET_ORDER_LN_NBR\n        )\n        OR IFF(ISNULL(OPERATION), '0', OPERATION) <> IFF(ISNULL(LKP_OPERATION), '0', LKP_OPERATION)\n        OR IFF(ISNULL(CUSTOMER_CODE), '0', CUSTOMER_CODE) <> IFF(\n          ISNULL(LKP_ALLIVET_CUSTOMER_NBR),\n          '0',\n          LKP_ALLIVET_CUSTOMER_NBR\n        )\n        OR IFF(ISNULL(EXTRA_INFO), '0', EXTRA_INFO) <> IFF(ISNULL(LKP_EXTRA_INFO), '0', LKP_EXTRA_INFO)\n        OR IFF(\n          ISNULL(CHANGE_DATE),\n          TO_DATE('9999-12-31', 'YYYY-MM-DD'),\n          CHANGE_DATE\n        ) <> IFF(\n          ISNULL(LKP_ORDER_CHG_DT),\n          TO_DATE('9999-12-31', 'YYYY-MM-DD'),\n          LKP_ORDER_CHG_DT\n        )\n        OR IFF(ISNULL(FROM_ITEM_CODE), '0', FROM_ITEM_CODE) <> IFF(ISNULL(LKP_FROM_ITEM_CD), '0', LKP_FROM_ITEM_CD)\n        OR IFF(ISNULL(TO_ITEM_CODE), '0', TO_ITEM_CODE) <> IFF(ISNULL(LKP_TO_ITEM_CD), '0', LKP_TO_ITEM_CD)\n        OR IFF(ISNULL(PRESCRIPTION_ID), -1, PRESCRIPTION_ID) <> IFF(\n          ISNULL(LKP_PRESCRIPTION_ID),\n          -1,\n          LKP_PRESCRIPTION_ID\n        )\n      ),\n      2,\n      0\n    )\n  ) AS UPDATE_FLAG,\n  Monotonically_Increasing_Id AS Monotonically_Increasing_Id\nFROM\n  Jnr_Audit_Target_4\"\"\")","df_5.createOrReplaceTempView(\"Exp_Update_Flag_5\")"]},"id":"Exp_Update_Flag","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Filter","label":"Filter_Update_Insert","queries":["df_6 = spark.sql(\"\"\"SELECT\n  ALLIVET_ORDER_CODE AS ALLIVET_ORDER_CODE,\n  ALLIVET_ORDER_COUNTER AS ALLIVET_ORDER_COUNTER,\n  ALLIVET_ORDER_LINE_NUMBER AS ALLIVET_ORDER_LINE_NUMBER,\n  OPERATION AS OPERATION,\n  CUSTOMER_CODE AS CUSTOMER_CODE,\n  EXTRA_INFO AS EXTRA_INFO,\n  CHANGE_DATE AS CHANGE_DATE,\n  FROM_ITEM_CODE AS FROM_ITEM_CODE,\n  TO_ITEM_CODE AS TO_ITEM_CODE,\n  PRESCRIPTION_ID AS PRESCRIPTION_ID,\n  LOAD_TSTMP AS LOAD_TSTMP,\n  UPDATE_TSTMP AS UPDATE_TSTMP,\n  UPDATE_FLAG AS UPDATE_FLAG,\n  Monotonically_Increasing_Id AS Monotonically_Increasing_Id\nFROM\n  Exp_Update_Flag_5\nWHERE\n  IN(UPDATE_FLAG, 1, 2)\"\"\")","df_6.createOrReplaceTempView(\"Filter_Update_Insert_6\")"]},"id":"Filter_Update_Insert","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Update Strategy","label":"UPDTRANS","queries":["df_7 = spark.sql(\"\"\"SELECT\n  ALLIVET_ORDER_CODE AS ALLIVET_ORDER_CODE,\n  ALLIVET_ORDER_COUNTER AS ALLIVET_ORDER_COUNTER,\n  ALLIVET_ORDER_LINE_NUMBER AS ALLIVET_ORDER_LINE_NUMBER,\n  OPERATION AS OPERATION,\n  CUSTOMER_CODE AS CUSTOMER_CODE,\n  EXTRA_INFO AS EXTRA_INFO,\n  CHANGE_DATE AS CHANGE_DATE,\n  FROM_ITEM_CODE AS FROM_ITEM_CODE,\n  TO_ITEM_CODE AS TO_ITEM_CODE,\n  PRESCRIPTION_ID AS PRESCRIPTION_ID,\n  LOAD_TSTMP AS LOAD_TSTMP,\n  UPDATE_TSTMP AS UPDATE_TSTMP,\n  UPDATE_FLAG AS UPDATE_FLAG,\n  Monotonically_Increasing_Id AS Monotonically_Increasing_Id,\n  DECODE(UPDATE_FLAG, 1, 'DD_INSERT', 2, 'DD_UPDATE') AS UPDATE_STRATEGY_FLAG\nFROM\n  Filter_Update_Insert_6\"\"\")","df_7.createOrReplaceTempView(\"UPDTRANS_7\")"]},"id":"UPDTRANS","position":{"x":0,"y":0},"type":"normalNode"},{"data":{"transformationType":"Target Definition","label":"Shortcut_to_ALLIVET_SYSTEM_AUDIT_DAY1","queries":["spark.sql(\"\"\"MERGE INTO ALLIVET_SYSTEM_AUDIT_DAY_V2_test AS TARGET\nUSING\n  UPDTRANS_7 AS SOURCE ON TARGET.ALLIVET_ORDER_CNTR = SOURCE.ALLIVET_ORDER_COUNTER\n  AND TARGET.ALLIVET_ORDER_NBR_V2_test = SOURCE.ALLIVET_ORDER_CODE\n  WHEN MATCHED\n  AND SOURCE.UPDATE_STRATEGY_FLAG = \"DD_UPDATE\" THEN\nUPDATE\nSET\n  TARGET.ALLIVET_ORDER_NBR_V2_test = SOURCE.ALLIVET_ORDER_CODE,\n  TARGET.ALLIVET_ORDER_CNTR = SOURCE.ALLIVET_ORDER_COUNTER,\n  TARGET.ALLIVET_ORDER_LN_NBR_V2_test = SOURCE.ALLIVET_ORDER_LINE_NUMBER,\n  TARGET.OPERATION_V2_test = SOURCE.OPERATION,\n  TARGET.ALLIVET_CUSTOMER_NBR = SOURCE.CUSTOMER_CODE,\n  TARGET.EXTRA_INFO = SOURCE.EXTRA_INFO,\n  TARGET.ORDER_CHG_DT = SOURCE.CHANGE_DATE,\n  TARGET.FROM_ITEM_CD = SOURCE.FROM_ITEM_CODE,\n  TARGET.TO_ITEM_CD = SOURCE.TO_ITEM_CODE,\n  TARGET.PRESCRIPTION_ID_V2_test = SOURCE.PRESCRIPTION_ID,\n  TARGET.UPDATE_TSTMP = SOURCE.UPDATE_TSTMP,\n  TARGET.LOAD_TSTMP = SOURCE.LOAD_TSTMP\n  WHEN MATCHED\n  AND SOURCE.UPDATE_STRATEGY_FLAG = \"DD_DELETE\"\n  AND TARGET.ALLIVET_ORDER_LN_NBR_V2_test = SOURCE.ALLIVET_ORDER_LINE_NUMBER\n  AND TARGET.OPERATION_V2_test = SOURCE.OPERATION\n  AND TARGET.ALLIVET_CUSTOMER_NBR = SOURCE.CUSTOMER_CODE\n  AND TARGET.EXTRA_INFO = SOURCE.EXTRA_INFO\n  AND TARGET.ORDER_CHG_DT = SOURCE.CHANGE_DATE\n  AND TARGET.FROM_ITEM_CD = SOURCE.FROM_ITEM_CODE\n  AND TARGET.TO_ITEM_CD = SOURCE.TO_ITEM_CODE\n  AND TARGET.PRESCRIPTION_ID_V2_test = SOURCE.PRESCRIPTION_ID\n  AND TARGET.UPDATE_TSTMP = SOURCE.UPDATE_TSTMP\n  AND TARGET.LOAD_TSTMP = SOURCE.LOAD_TSTMP THEN DELETE\n  WHEN NOT MATCHED\n  AND SOURCE.UPDATE_STRATEGY_FLAG = \"DD_INSERT\" THEN\nINSERT\n  (\n    TARGET.ALLIVET_ORDER_NBR_V2_test,\n    TARGET.ALLIVET_ORDER_CNTR,\n    TARGET.ALLIVET_ORDER_LN_NBR_V2_test,\n    TARGET.OPERATION_V2_test,\n    TARGET.ALLIVET_CUSTOMER_NBR,\n    TARGET.EXTRA_INFO,\n    TARGET.ORDER_CHG_DT,\n    TARGET.FROM_ITEM_CD,\n    TARGET.TO_ITEM_CD,\n    TARGET.PRESCRIPTION_ID_V2_test,\n    TARGET.UPDATE_TSTMP,\n    TARGET.LOAD_TSTMP\n  )\nVALUES\n  (\n    SOURCE.ALLIVET_ORDER_CODE,\n    SOURCE.ALLIVET_ORDER_COUNTER,\n    SOURCE.ALLIVET_ORDER_LINE_NUMBER,\n    SOURCE.OPERATION,\n    SOURCE.CUSTOMER_CODE,\n    SOURCE.EXTRA_INFO,\n    SOURCE.CHANGE_DATE,\n    SOURCE.FROM_ITEM_CODE,\n    SOURCE.TO_ITEM_CODE,\n    SOURCE.PRESCRIPTION_ID,\n    SOURCE.UPDATE_TSTMP,\n    SOURCE.LOAD_TSTMP\n  )\"\"\")"]},"id":"Shortcut_to_ALLIVET_SYSTEM_AUDIT_DAY1","position":{"x":0,"y":0},"type":"normalNode"}]}